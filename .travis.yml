language: node_js
dist: trusty
services:
  - postgresql
addons:
  postgresql: "9.5"
sudo: true
before_install:
  - sudo apt-get install -y postgresql-9.5-postgis-2.3
  - sudo service postgresql restart
  - psql -c 'create database bottleneck_development;' -U postgres
  - psql -U postgres -c "create extension postgis"
script: npm run-script coveralls
deploy:
  provider: elasticbeanstalk
  on:
    branch: master
  access_key_id: $AWS_ACCESS_KEY_ID
  secret_access_key: $AWS_SECRET_ACCESS_KEY
  region: "us-east-2"
  app: "bottleneck"
  env: "Bottleneck-env"
  bucket_name: $S3_BUCKET
env:
  global:
    - DATABASE_URL=postgresql://postgres@localhost:5432/bottleneck_development
